---
layout:     post
title:      (db)数据库事务管理（5）
subtitle:   故障与日志策略
date:       2019-01-29
author:     Wenguangliu
header-img: img/post-bg-unix-linux.jpg
catalog: 	 true
tags:
    - 数据库
    - 故障
    - 日志
    - 事务
    - Redo日志
    - Undo日志
---

本文将开始介绍数据库管理系统中的故障以及应对策略。在数据库管理中，最常见的应对策略就是日志，通过Redo，Undo日志来维护数据库事务中出现的错误。   
本文首先将介绍数据库中常见的故障模式，然后介绍Redo日志，Undo日志，Redo/Undo日志，最后介绍应对故障的其他一些策略。

## 故障模式与事务
数据库中出现故障是常有的事情，这些问题大体可以分为：
- 错误数据输入： 用户将错误数据输入到数据库，违背了数据库的一致性。例如电话号码输错一位。一般采用约束和促发器识别这些错误。
- 介质故障： 硬盘的局部故障，例如改变了一位或几位，这种可以通过奇偶校验码进行检测和纠正；如果整个磁盘都损坏了，那么需要RAID，备份等途径进行恢复。
- 灾难性故障：是指外部如火灾，地震等造成的故障。面对这种故障一般采用分布备份方法进行预防和恢复。
- 系统故障：数据库中的事物是一步一步进行的，当进行到一半发生故障（如断电），会造成事物状态的丢失，造成数据的不一致。针对这种错误，则需要日志方法进行修复，也就是本文的重点。

数据库事务是数据库操作执行的单元，为了确保数据库数据的一致性，必须保证数据库事务具有：
- 原子性（Atomic）：即事务要么全部完成，要么像没有执行过一样，最终状态不能够时中间的某一个不合法的状态；
- 一致性（Consistency）：即事务执行前和执行后，均要满足数据库的数据一致性。例如，A向B转账100元，那么A的账户首先至少有100元的余额；在完成转账过程中，A的账户减少了100元，B的账户多了100元，满足全量不变性；
- 隔离性（Isolation）： 事务之间不能够影响，即事务之间的状态是不可见的。隔离性按照隔离粒度不同，可以分为：未提交读（READ UNCOMMITED），即事务能够读到其他事务中未提交的状态；提交读（READ COMMITTED）：基于锁机制的并发控制需要对选定对象的写锁一直保持到事物结束，但是读锁是操作后马上释放，因此可能出现“不可重复读”现象；可重复读（REPEATABLE READS）：即基于锁并发控制需要对选定对象的读锁和写锁均保持到事务结束，但不要求“范围锁”，所以可能出现“幻读”；可串行化（SERIABLE）：最高的隔离级别，在基于锁的并发控制中，除了要求选定对象上的读锁和写锁要保持到事务结束后才释放，并且在SELECT语句中WHERE子句描述一个范围时，应该获得一个“范围锁”，避免幻读。
- 持久性（Durability）：事务提交后，系统的状态时永久的。

## Redo日志


## Undo日志


## Redo/Undo日志


## 其他策略